<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesure Sprint Flash - Calculateur d'Ajustements</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input-focus {
            transition: all 0.3s ease;
        }
        
        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .result-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .result-card.positive {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }
        
        .result-card.negative {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2, #fecaca);
        }
        
        .result-card.neutral {
            border-left-color: #6b7280;
            background: linear-gradient(135deg, #f9fafb, #e5e7eb);
        }
        
        .animate-bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.05) rotate(2deg); }
            70% { transform: scale(0.9) rotate(-1deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok { background-color: #10b981; }
        .status-warning { background-color: #f59e0b; }
        .status-error { background-color: #ef4444; }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.3s;
        }
        
        .precision-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex flex-col items-center justify-center p-4">
    <div class="glass-effect p-6 max-w-2xl mx-auto rounded-2xl shadow-2xl w-full">
        <!-- En-t√™te avec indicateur de statut -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">‚ö° Mesure Sprint Flash</h1>
            <p class="text-gray-600">Calculateur d'ajustements automatique</p>
            <div class="mt-2 flex justify-center items-center">
                <span id="statusIndicator" class="status-indicator status-ok"></span>
                <span id="statusText" class="text-sm text-gray-600">Pr√™t pour calcul</span>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Valeurs Attendues -->
            <div class="space-y-4">
                <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-400">
                    <h2 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                        üéØ Valeurs Attendues
                        <span class="ml-2 precision-badge bg-blue-200 text-blue-800">R√©f√©rence</span>
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label for="attenduFreins" class="block text-gray-700 font-medium mb-2">
                                C√¥t√© Freins (mm) :
                                <span class="tooltip text-blue-500 ml-1" data-tooltip="Valeur cible pour le c√¥t√© freins">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="attenduFreins" value="142" step="0.1" 
                                   class="input-focus w-full px-4 py-3 border-2 border-blue-200 rounded-lg text-lg font-semibold text-center hover:border-blue-400 focus:border-blue-500 focus:outline-none">
                        </div>
                        <div>
                            <label for="attenduCoupe" class="block text-gray-700 font-medium mb-2">
                                C√¥t√© Coupe (mm) :
                                <span class="tooltip text-blue-500 ml-1" data-tooltip="Valeur cible pour le c√¥t√© coupe">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="attenduCoupe" value="145" step="0.1"
                                   class="input-focus w-full px-4 py-3 border-2 border-blue-200 rounded-lg text-lg font-semibold text-center hover:border-blue-400 focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Valeurs Mesur√©es -->
            <div class="space-y-4">
                <div class="bg-green-50 p-4 rounded-xl border-l-4 border-green-400">
                    <h2 class="text-lg font-semibold mb-4 text-green-800 flex items-center">
                        üìè Valeurs Mesur√©es
                        <span class="ml-2 precision-badge bg-green-200 text-green-800">R√©el</span>
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label for="mesureFreins" class="block text-gray-700 font-medium mb-2">
                                C√¥t√© Freins (mm) :
                                <span class="tooltip text-green-500 ml-1" data-tooltip="Mesure r√©elle c√¥t√© freins">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="mesureFreins" value="147" step="0.1"
                                   class="input-focus w-full px-4 py-3 border-2 border-green-200 rounded-lg text-lg font-semibold text-center hover:border-green-400 focus:border-green-500 focus:outline-none">
                        </div>
                        <div>
                            <label for="mesureCoupe" class="block text-gray-700 font-medium mb-2">
                                C√¥t√© Coupe (mm) :
                                <span class="tooltip text-green-500 ml-1" data-tooltip="Mesure r√©elle c√¥t√© coupe">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="mesureCoupe" value="141" step="0.1"
                                   class="input-focus w-full px-4 py-3 border-2 border-green-200 rounded-lg text-lg font-semibold text-center hover:border-green-400 focus:border-green-500 focus:outline-none">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- R√©sultats des ajustements -->
        <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
            <h2 class="text-xl font-bold mb-6 text-purple-800 flex items-center justify-center">
                üîß Ajustements Recommand√©s
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div id="centrageCard" class="result-card p-4 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-gray-700">Centrage</p>
                            <p class="text-xs text-gray-500">OffSet 29-31</p>
                        </div>
                        <div class="text-right">
                            <span id="centrageResultat" class="text-2xl font-bold">0.0 mm</span>
                            <div id="centrageStatus" class="text-xs mt-1"></div>
                        </div>
                    </div>
                </div>
                
                <div id="longueurCard" class="result-card p-4 rounded-xl shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-gray-700">Longueur Fil</p>
                            <p class="text-xs text-gray-500">OffSet 114-115</p>
                        </div>
                        <div class="text-right">
                            <span id="longueurFilResultat" class="text-2xl font-bold">0.0 mm</span>
                            <div id="longueurStatus" class="text-xs mt-1"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pr√©diction des r√©sultats -->
            <div class="mt-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl border border-green-200">
                <h3 class="text-lg font-semibold mb-4 text-green-800 flex items-center justify-center">
                    üéØ R√©sultats Th√©oriques Apr√®s Ajustements
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-green-400">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-700">C√¥t√© Freins</p>
                                <p class="text-xs text-gray-500">Apr√®s ajustements</p>
                            </div>
                            <div class="text-right">
                                <span id="predictionFreins" class="text-xl font-bold text-green-600">0.0 mm</span>
                                <div id="ecartFreinsFinal" class="text-xs mt-1"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-400">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-700">C√¥t√© Coupe</p>
                                <p class="text-xs text-gray-500">Apr√®s ajustements</p>
                            </div>
                            <div class="text-right">
                                <span id="predictionCoupe" class="text-xl font-bold text-blue-600">0.0 mm</span>
                                <div id="ecartCoupeFinal" class="text-xs mt-1"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-white rounded-lg border border-gray-200">
                    <h4 class="font-medium text-gray-700 mb-2">üìù D√©tail des Corrections</h4>
                    <div id="detailCorrections" class="text-sm space-y-1">
                        <!-- D√©tail des corrections sera affich√© ici -->
                    </div>
                </div>
            </div>
            
            <!-- Analyse d√©taill√©e -->
            <details class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <summary class="font-semibold text-gray-700 cursor-pointer hover:text-purple-600 transition-colors">
                    üìä Analyse D√©taill√©e du Calcul
                </summary>
                <div id="calculDetails" class="mt-4 space-y-2 text-sm">
                    <!-- D√©tails du calcul seront affich√©s ici -->
                </div>
            </details>
            
            <!-- Bouton de r√©initialisation -->
            <div class="mt-6 text-center">
                <button id="resetBtn" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-semibold">
                    üîÑ R√©initialiser
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration par d√©faut
        const DEFAULT_VALUES = {
            attenduFreins: 142,
            attenduCoupe: 145,
            mesureFreins: 147,
            mesureCoupe: 141
        };

        // Fonction pour d√©terminer le statut bas√© sur la valeur
        function getStatus(value, threshold = 1) {
            const abs = Math.abs(value);
            if (abs <= 0.1) return 'perfect';
            if (abs <= threshold) return 'good';
            if (abs <= threshold * 2) return 'warning';
            return 'error';
        }

        // Fonction pour appliquer le style de carte selon le statut
        function updateCardStyle(cardElement, value) {
            cardElement.classList.remove('positive', 'negative', 'neutral');
            if (Math.abs(value) <= 0.1) {
                cardElement.classList.add('neutral');
            } else if (value > 0) {
                cardElement.classList.add('positive');
            } else {
                cardElement.classList.add('negative');
            }
        }

        // Fonction pour mettre √† jour l'indicateur de statut g√©n√©ral
        function updateGlobalStatus(centrageValue, longueurValue) {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            const maxError = Math.max(Math.abs(centrageValue), Math.abs(longueurValue));
            
            statusIndicator.classList.remove('status-ok', 'status-warning', 'status-error');
            
            if (maxError <= 0.1) {
                statusIndicator.classList.add('status-ok');
                statusText.textContent = 'Valeurs parfaites ‚úì';
            } else if (maxError <= 1) {
                statusIndicator.classList.add('status-warning');
                statusText.textContent = 'Ajustements mineurs requis';
            } else {
                statusIndicator.classList.add('status-error');
                statusText.textContent = 'Ajustements importants n√©cessaires';
            }
        }

        // Fonction pour calculer les pr√©dictions apr√®s ajustements
        function calculatePredictions(mesureFreins, mesureCoupe, ajustementCentrage, ajustementLongueurFil, attenduFreins, attenduCoupe) {
            // Calcul des effets du centrage
            // Centrage: chaque -0.2mm offset = +1mm c√¥t√© coupe, -1mm c√¥t√© frein
            const effetCentrageSurCoupe = (ajustementCentrage / -0.2); // +1mm par -0.2mm offset
            const effetCentrageSurFrein = -(ajustementCentrage / -0.2); // -1mm par -0.2mm offset
            
            // Calcul des effets de la longueur fil
            // Longueur fil: chaque +1.5mm offset = +1mm c√¥t√© frein uniquement
            const effetLongueurSurFrein = ajustementLongueurFil * 1.5;
            
            // Valeurs finales th√©oriques
            const nouvelleValeurCoupe = mesureCoupe + effetCentrageSurCoupe;
            const nouvelleValeurFrein = mesureFreins + effetCentrageSurFrein + effetLongueurSurFrein;
            
            // Calcul des √©carts finaux
            const ecartFinalCoupe = attenduCoupe - nouvelleValeurCoupe;
            const ecartFinalFrein = attenduFreins - nouvelleValeurFrein;
            
            // Mise √† jour de l'affichage
            document.getElementById('predictionFreins').textContent = `${nouvelleValeurFrein.toFixed(1)} mm`;
            document.getElementById('predictionCoupe').textContent = `${nouvelleValeurCoupe.toFixed(1)} mm`;
            
            // Mise √† jour des √©carts finaux
            const ecartFreinsElement = document.getElementById('ecartFreinsFinal');
            const ecartCoupeElement = document.getElementById('ecartCoupeFinal');
            
            ecartFreinsElement.textContent = Math.abs(ecartFinalFrein) <= 0.1 ? 'Parfait ‚úì' : 
                `√âcart: ${ecartFinalFrein.toFixed(1)}mm`;
            ecartFreinsElement.className = `text-xs mt-1 ${Math.abs(ecartFinalFrein) <= 0.5 ? 'text-green-600' : 'text-orange-600'}`;
            
            ecartCoupeElement.textContent = Math.abs(ecartFinalCoupe) <= 0.1 ? 'Parfait ‚úì' : 
                `√âcart: ${ecartFinalCoupe.toFixed(1)}mm`;
            ecartCoupeElement.className = `text-xs mt-1 ${Math.abs(ecartFinalCoupe) <= 0.5 ? 'text-green-600' : 'text-orange-600'}`;
            
            // D√©tail des corrections
            document.getElementById('detailCorrections').innerHTML = `
                <div class="text-xs text-gray-600 space-y-1">
                    <p><strong>√âtape 1 - Centrage (${ajustementCentrage.toFixed(1)}mm):</strong></p>
                    <p class="ml-4">‚Ä¢ C√¥t√© coupe: ${mesureCoupe.toFixed(1)} + ${effetCentrageSurCoupe.toFixed(1)} = ${(mesureCoupe + effetCentrageSurCoupe).toFixed(1)}mm</p>
                    <p class="ml-4">‚Ä¢ C√¥t√© frein: ${mesureFreins.toFixed(1)} + ${effetCentrageSurFrein.toFixed(1)} = ${(mesureFreins + effetCentrageSurFrein).toFixed(1)}mm</p>
                    <p><strong>√âtape 2 - Longueur fil (${ajustementLongueurFil.toFixed(1)}mm):</strong></p>
                    <p class="ml-4">‚Ä¢ C√¥t√© frein: ${(mesureFreins + effetCentrageSurFrein).toFixed(1)} + ${effetLongueurSurFrein.toFixed(1)} = ${nouvelleValeurFrein.toFixed(1)}mm</p>
                </div>
            `;
        }

        // Fonction principale de recalcul
        function recalculerAjustements() {
            try {
                // R√©cup√©rer les valeurs des entr√©es avec validation
                const attenduFreins = parseFloat(document.getElementById('attenduFreins').value) || 0;
                const attenduCoupe = parseFloat(document.getElementById('attenduCoupe').value) || 0;
                const mesureFreins = parseFloat(document.getElementById('mesureFreins').value) || 0;
                const mesureCoupe = parseFloat(document.getElementById('mesureCoupe').value) || 0;
                
                // Validation des entr√©es
                if ([attenduFreins, attenduCoupe, mesureFreins, mesureCoupe].some(val => val <= 0)) {
                    throw new Error('Toutes les valeurs doivent √™tre positives');
                }
                
                // Calculer les √©carts (valeur attendue - valeur mesur√©e)
                const ecartFreins = attenduFreins - mesureFreins; 
                const ecartCoupe = attenduCoupe - mesureCoupe;   
                
                // Calculs d'ajustement
                let ajustementCentrage = -0.2 * ecartCoupe;
                let ecartFreinsResiduel = ecartFreins + ecartCoupe;
                // Correction: +1.5mm d'offset = +1mm r√©el, donc offset = √©cart / 1.5
                let ajustementLongueurFilBrut = ecartFreinsResiduel / 1.5;
                
                // Arrondir le centrage √† 1 d√©cimale
                ajustementCentrage = Math.round(ajustementCentrage * 10) / 10;
                
                // Arrondir la longueur du fil au 0.5 le plus proche
                let ajustementLongueurFil = Math.round(ajustementLongueurFilBrut * 2) / 2;
                
                // Mettre √† jour l'interface
                const centrageElement = document.getElementById('centrageResultat');
                const longueurElement = document.getElementById('longueurFilResultat');
                const centrageCard = document.getElementById('centrageCard');
                const longueurCard = document.getElementById('longueurCard');
                
                // Animation de mise √† jour
                [centrageElement, longueurElement].forEach(el => {
                    el.classList.add('animate-bounce-in');
                    setTimeout(() => el.classList.remove('animate-bounce-in'), 600);
                });
                
                // Mise √† jour des valeurs
                centrageElement.textContent = `${ajustementCentrage.toFixed(1)} mm`;
                longueurElement.textContent = `${ajustementLongueurFil.toFixed(1)} mm`;
                
                // Mise √† jour des styles de cartes
                updateCardStyle(centrageCard, ajustementCentrage);
                updateCardStyle(longueurCard, ajustementLongueurFil);
                
                // Mise √† jour des statuts individuels
                document.getElementById('centrageStatus').textContent = 
                    getStatus(ajustementCentrage) === 'perfect' ? 'Parfait ‚úì' : 
                    Math.abs(ajustementCentrage) <= 1 ? 'Acceptable' : 'Critique';
                    
                document.getElementById('longueurStatus').textContent = 
                    getStatus(ajustementLongueurFil) === 'perfect' ? 'Parfait ‚úì' : 
                    Math.abs(ajustementLongueurFil) <= 1 ? 'Acceptable' : 'Critique';
                
                // Mise √† jour du statut global
                updateGlobalStatus(ajustementCentrage, ajustementLongueurFil);
                
                // Calcul des valeurs th√©oriques apr√®s ajustements
                calculatePredictions(mesureFreins, mesureCoupe, ajustementCentrage, ajustementLongueurFil, attenduFreins, attenduCoupe);
                
                // Mise √† jour des d√©tails
                const detailsContainer = document.getElementById('calculDetails');
                detailsContainer.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <h4 class="font-semibold text-purple-700">üìä √âcarts Mesur√©s</h4>
                            <p>‚Ä¢ C√¥t√© freins: <span class="font-mono ${ecartFreins >= 0 ? 'text-red-600' : 'text-green-600'}">${ecartFreins.toFixed(1)} mm</span></p>
                            <p>‚Ä¢ C√¥t√© coupe: <span class="font-mono ${ecartCoupe >= 0 ? 'text-red-600' : 'text-green-600'}">${ecartCoupe.toFixed(1)} mm</span></p>
                        </div>
                        <div class="space-y-2">
                            <h4 class="font-semibold text-purple-700">üîß Corrections Calcul√©es</h4>
                            <p>‚Ä¢ Centrage: <span class="font-mono font-bold">${ajustementCentrage.toFixed(1)} mm</span></p>
                            <p>‚Ä¢ √âcart r√©siduel freins: <span class="font-mono">${ecartFreinsResiduel.toFixed(1)} mm</span></p>
                            <p>‚Ä¢ Longueur fil (brut): <span class="font-mono">${ajustementLongueurFilBrut.toFixed(2)} mm</span></p>
                            <p>‚Ä¢ Longueur fil (arrondi 0.5): <span class="font-mono font-bold">${ajustementLongueurFil.toFixed(1)} mm</span></p>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-gray-700 mb-2">üí° Principe de Calcul</h4>
                        <p class="text-xs text-gray-600">
                            1. Centrage: -0.2mm d'offset = +1mm c√¥t√© coupe, -1mm c√¥t√© freins<br>
                            2. Longueur fil: +1.5mm d'offset = +1mm sur la pose r√©elle<br>
                            3. <strong>Longueur fil arrondie au 0.5mm le plus proche</strong>
                        </p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Erreur de calcul:', error);
                document.getElementById('statusText').textContent = 'Erreur de calcul';
                document.getElementById('statusIndicator').className = 'status-indicator status-error';
            }
        }

        // Fonction de r√©initialisation
        function resetValues() {
            Object.entries(DEFAULT_VALUES).forEach(([id, value]) => {
                document.getElementById(id).value = value;
            });
            recalculerAjustements();
        }

        // √âv√©nements
        document.addEventListener('DOMContentLoaded', function() {
            // Ajout des √©v√©nements sur les inputs
            document.querySelectorAll('#attenduFreins, #attenduCoupe, #mesureFreins, #mesureCoupe').forEach(input => {
                input.addEventListener('input', recalculerAjustements);
                input.addEventListener('focus', function() {
                    this.select();
                });
            });

            // √âv√©nement pour le bouton de r√©initialisation
            document.getElementById('resetBtn').addEventListener('click', resetValues);

            // Calcul initial
            recalculerAjustements();
        });

        // Gestion des raccourcis clavier
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetValues();
            }
        });
    </script>
</body>
</html>
